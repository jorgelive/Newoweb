{% extends 'base_sonata_admin/show.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <style>

        @import url(https://fonts.googleapis.com/css?family=Permanent+Marker);

        .post-it { max-width:450px; position:relative; background:#ffa; overflow:hidden; margin:15px auto 30px auto; padding:20px; border-radius:0 0 0 30px/45px; box-shadow: inset 0 -40px 40px rgba(0,0,0,0.2), inset 0 25px 10px rgba(0,0,0,0.2), 0 5px 6px 5px rgba(0,0,0,0.2); font-family: 'Permanent Marker', cursive; line-height:1.7em; font-size: 0.9em; -webkit-mask-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYGBgAAgwAAAEAAGbA+oJAAAAAElFTkSuQmCC); color: #130d6b; }
        .post-it:before { content:""; display:block; position:absolute; width:20px; height:25px; background:#ffa; box-shadow: 3px -2px 10px rgba(0,0,0,0.2), inset 15px -15px 15px rgba(0,0,0,0.3); left:0; bottom:0; z-index:2; transform:skewX(25deg); }
        .post-it:after { content:""; display:block; position:absolute; width:75%; height:20px; border-top:3px solid #130d6b; border-radius: 50% ; bottom:0; left:10%; }

        #tab-{{ admin.uniqid }}-operativa .fila { list-style: none; }
        #tab-{{ admin.uniqid }}-operativa .fila.servicio { padding-inline-start: 0; margin: 5px; }
        #tab-{{ admin.uniqid }}-operativa .fila li { list-style: none; border-top: 1px solid #ccc; border-bottom: 1px solid #ccc; border-left: 1px solid #ccc; margin-bottom: 5px; }
        #tab-{{ admin.uniqid }}-operativa .celda { display: inline-block; padding: 0 5px; }
        #tab-{{ admin.uniqid }}-operativa .celda.heading { font-weight: bold; font-size: 0.8em; vertical-align: top; }

        #tab-{{ admin.uniqid }}-resumen .resumen-item { padding: 5px 0;}
        #tab-{{ admin.uniqid }}-resumen .resumen-servicios p.componente-incluye {}
        
        .titulo{font-size: 0.8em; font-weight: bold; }
        .generales-box .box-header { display: none; }
        .generales-box .box-body .resumen-text { min-height: 20px; margin: 10px 0; border-radius: 5px; font-size: 1.1em; padding: 7px 7px 0 7px; background-color: rgba(147, 184, 255, 0.2) }
        .generales-box .box-body .codigo { color: {{ colores.verde_claro }}; float: right; font-size: 1.1em; font-weight: 600; }
        .generales-box .box-body .idioma { color: {{ colores.rojo_oscuro }}; }

        .boton-acordeonsuperior.acordeon-tickets { background-color: #f39c1240; }
        .boton-acordeonsuperior { padding: 7px 10px; }
        .boton-acordeonsuperior .panel-title>a { font-size: 14px; font-weight: 600; }
        .boton-acordeonsuperior .panel-title>a:hover { color: gray; }

        /* Centrar últimas filas en grids de Bootstrap 3 usando flex */
        .thumbs-row{
            display: flex;
            flex-wrap: wrap;
            justify-content: center;          /* <-- aquí sucede la magia */
        }

        .thumbs-row > [class*="col-"]{
            float: none !important;           /* anulamos el float de B3 */
            /* no necesitas tocar width: las col-* ya traen % de Bootstrap */
        }

    </style>
{% endblock %}

{% block show %}

<div class="sonata-ba-view">

    {{ sonata_block_render_event('sonata.admin.show.top', { 'admin': admin, 'object': object }) }}

    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            {% trans_default_domain 'messages' %}

            {# IDs únicos para el acordeón #}
            {% set acc_id = 'accordion-' ~ (object.id is defined ? object.id : random()) %}
            {% set col1_id = acc_id ~ '-collapse1' %}
            {% set col2_id = acc_id ~ '-collapse2' %}

            {# Teléfono limpiecito para el enlace de WhatsApp (no afecta el copy) #}
            {% set phone_clean = object.file.telefono|replace({'-':'','+':'','(':'',')':'',' ':'','.’':''}) %}

            <div class="generales-box box box-primary">
                <div class="box-header with-border">
                    <h4 class="box-title" style="margin:0;">{{ 'detalle'|trans|capitalize }}</h4>
                </div>

                <div class="box-body table-responsive no-padding">
                    <table class="table table-hover" style="margin:0;">
                        <tbody>
                        {% if action == 'show' %}
                            <tr class="sonata-ba-view-container">
                                <th scope="row" class="text-muted">{{ 'cotizacion'|trans|capitalize }}</th>
                                <td>{{ object.nombre }}</td>
                            </tr>
                        {% endif %}

                        <tr class="sonata-ba-view-container">
                            {% if object.file.catalogo != true %}
                                <th scope="row" class="text-muted">{{ 'nombre'|trans|capitalize }}</th>
                                <td>
                                    <strong>{{ object.file.nombre }}</strong>
                                    {% if object.numeropasajeros %} <span class="text-muted">× {{ object.numeropasajeros }}</span>{% endif %}
                                    – {{ object.file.pais.nombre }}
                                    <span class="idioma">({{ object.file.idioma.nombre }})</span>
                                    <span class="codigo label label-primary">{{ object.codigo }}</span>
                                </td>
                            {% else %}
                                <th scope="row" class="text-muted">{{ 'codigo'|trans|capitalize }}</th>
                                <td><span class="codigo label label-primary">{{ object.codigo }}</span></td>
                            {% endif %}
                        </tr>

                        {% if action != 'resumen' and object.file.telefono is not empty %}
                            <tr class="sonata-ba-view-container">
                                <th scope="row" class="text-muted">Contacto</th>
                                <td>
                                    <a href="tel:{{ object.file.telefono }}" class="btn btn-sm btn-success">
                                        <i class="fa fa-phone" aria-hidden="true"></i> Llamar
                                    </a>

                                    {# === NO TOCAR: botón de copiar mantiene clase y data-* === #}
                                    <a data-text="{{ object.file.telefono }}"
                                       data-tooltiptext="Copiado al portapapeles"
                                       class="btn btn-sm btn-success clipboard-trigger">
                                        <i class="fa fa-file-text" aria-hidden="true"></i> Copiar número
                                    </a>

                                    <a href="https://wa.me/{{ phone_clean }}"
                                       target="_blank" rel="noopener"
                                       class="btn btn-sm btn-success edit_link">
                                        <i class="fa fa-whatsapp" aria-hidden="true"></i> Whatsapp
                                    </a>
                                </td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>

                    <div class="box-body container-fluid">
                        {% if object.resumen is not null and object.resumen is not empty %}
                            <div class="resumen-text ck-content">{{ object.resumen|raw }}</div>
                        {% else %}
                            {% if app.request.locale != app.request.defaultLocale %}
                                <div class="resumen-text ck-content" style="opacity:.6;">{{ object.resumenoriginal|raw }}</div>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>

            {% if object.file.filepasajeros is not empty or object.file.filedocumentos is not empty %}
                <div class="panel-group box box-primary" id="{{ acc_id }}" role="tablist" aria-multiselectable="true">

                    {% if object.file.filepasajeros|length > 0 %}
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{ col1_id }}-header">
                                <h5 class="panel-title" style="margin:0;">
                                    <a class="collapsed" data-toggle="collapse" data-parent="#{{ acc_id }}"
                                       href="#{{ col1_id }}" aria-expanded="false" aria-controls="{{ col1_id }}">
                                        <i class="fas fa-users tab-icon" aria-hidden="true"></i> {{ 'namelist'|trans|capitalize }}
                                    </a>
                                </h5>
                            </div>
                            <div id="{{ col1_id }}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="{{ col1_id }}-header">
                                <div class="panel-body table-responsive no-padding">
                                    <table class="table table-bordered table-striped sonata-ba-list" style="margin:0;">
                                        <thead>
                                        <tr class="sonata-ba-list-field-header">
                                            <th scope="col">{{ 'nombres'|trans|capitalize }}</th>
                                            <th scope="col">{{ 'apellidos'|trans|capitalize }}</th>
                                            <th scope="col">{{ 'pais'|trans|capitalize }}</th>
                                            <th scope="col">{{ 'sexo'|trans|capitalize }}</th>
                                            <th scope="col">{{ 'tipodoc'|trans|capitalize }}</th>
                                            <th scope="col">{{ 'numerodoc'|trans|capitalize }}</th>
                                            <th scope="col">{{ 'fechanacimiento'|trans|capitalize }}</th>
                                            <th scope="col">{{ 'edad'|trans|capitalize }}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for pasajero in object.file.filepasajeros %}
                                            <tr>
                                                <td>{{ pasajero.nombre }}</td>
                                                <td>{{ pasajero.apellido }}</td>
                                                <td>{{ pasajero.pais.nombre }}</td>
                                                <td>{{ pasajero.sexo.nombre }}</td>
                                                <td>{{ pasajero.tipodocumento.nombre }}</td>
                                                <td>{{ pasajero.numerodocumento }}</td>
                                                <td>{{ pasajero.fechanacimiento|date('d/m/Y', 'America/Lima') }}</td>
                                                <td>{{ pasajero.edad }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    {% if object.file.filedocumentos|length > 0 %}
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="{{ col2_id }}-header">
                                <h5 class="panel-title" style="margin:0;">
                                    <a class="collapsed" data-toggle="collapse" data-parent="#{{ acc_id }}"
                                       href="#{{ col2_id }}" aria-expanded="false" aria-controls="{{ col2_id }}">
                                        <i class="fas fa-file tab-icon" aria-hidden="true"></i> {{ 'tickets_y_documentos'|trans|capitalize }}
                                    </a>
                                </h5>
                            </div>
                            <div id="{{ col2_id }}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="{{ col2_id }}-header">
                                <div class="panel-body">
                                    <div class="container-fluid">
                                        <div class="row thumbs-row">   {# <-- agrega esta fila con la clase #}
                                            {% for archivo in object.file.filedocumentos %}
                                                {% if (action == 'show' or ((action == 'resumen' or action == 'operaciones') and archivo.tipofiledocumento.interno == false )) %}
                                                    <div class="col-xs-4 col-sm-2">
                                                        <div class="thumbnail thumbnail-fluid">
                                                            <a href="{% if archivo.tipo == 'local' %}{{ app.request.getSchemeAndHttpHost() ~ archivo.webPath|raw }}{% else %}{{ archivo.webPath|raw }}{% endif %}"
                                                                    {% if archivo.inModal == true %} data-toggle="lightbox"{% else %} target="_blank" rel="noopener"{% endif %}>
                                                                <img src="{% if archivo.tipo == 'local' %}{{ app.request.getSchemeAndHttpHost() ~ archivo.webThumbPath|raw }}{% else %}{{ archivo.webThumbPath|raw }}{% endif %}"
                                                                     alt="{{ archivo.nombre }}"
                                                                     class="{% if archivo.inModal == true %}in-modal{% endif %} {% if archivo.aspectRatio is not null and archivo.aspectRatio < 1 %}portrait{% elseif archivo.aspectRatio >= 1 %}landscape{% endif %}">
                                                                <div class="caption">
                                                                    <p class="small text-center" style="overflow-wrap:break-word;">{{ archivo.nombre }}</p>
                                                                </div>
                                                            </a>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                </div>
            {% endif %}


            {# NAV TABS CUSTOM MODERNO #}
            <div class="nav-tabs-custom nav-tabs-custom--modern">

                {# barra con scroll horizontal en móviles #}
                <div class="tabs-scroller tabs-scroller--wrap hidden-print">
                    <ul class="nav nav-tabs nav-tabs-modern nav-tabs-modern--wrap" role="tablist">

                    <li role="presentation" class="active">
                            <a href="#tab-{{ admin.uniqid }}-resumen"
                               role="tab" aria-controls="tab-{{ admin.uniqid }}-resumen"
                               aria-selected="true" data-toggle="tab">
                                <i style="color: {{ colores.lila }};" class="fas fa-list tab-icon" aria-hidden="true"></i>
                                <span>{{ 'tab_resumen'|trans({},'messages')|capitalize}}</span>
                            </a>
                        </li>

                        <li role="presentation">
                            <a href="#tab-{{ admin.uniqid }}-itinerario"
                               role="tab" aria-controls="tab-{{ admin.uniqid }}-itinerario"
                               aria-selected="false" data-toggle="tab">
                                <i style="color: {{ colores.lila }};" class="fas fa-map tab-icon" aria-hidden="true"></i>
                                <span>{{ 'tab_itinerario'|trans({},'messages')|capitalize}}</span>
                            </a>
                        </li>

                        {% if action == 'show' or (action == 'resumen' and object.precioocultoresumen == false) %}
                            <li role="presentation">
                                <a href="#tab-{{ admin.uniqid }}-tarifas"
                                   role="tab" aria-controls="tab-{{ admin.uniqid }}-tarifas"
                                   aria-selected="false" data-toggle="tab">
                                    <i style="color: {{ colores.verde_oscuro }};" class="fas fa-dollar-sign tab-icon" aria-hidden="true"></i>
                                    <span>{{ 'tab_precio'|trans({},'messages')|capitalize}}</span>
                                </a>
                            </li>
                        {% endif %}

                        <li role="presentation">
                            <a href="#tab-{{ admin.uniqid }}-incluye"
                               role="tab" aria-controls="tab-{{ admin.uniqid }}-incluye"
                               aria-selected="false" data-toggle="tab">
                                <i style="color: #ff9090" class="fas fa-check tab-icon" aria-hidden="true"></i>
                                <span>{{ 'tab_incluidos'|trans({},'messages')|capitalize}}</span>
                            </a>
                        </li>


                        {% if action == 'show' or (action == 'resumen' and object.precioocultoresumen == false) %}
                            <li role="presentation">
                                <a href="#tab-{{ admin.uniqid }}-politica"
                                   role="tab" aria-controls="tab-{{ admin.uniqid }}-politica"
                                   aria-selected="false" data-toggle="tab">
                                    <i class="fas fa-exclamation tab-icon" aria-hidden="true"></i>
                                    <span>{{ 'tab_terminos'|trans({},'messages')|capitalize}}</span>
                                </a>
                            </li>
                        {% endif %}

                        {% if action == 'show' %}
                            <li role="presentation">
                                <a href="#tab-{{ admin.uniqid }}-valores"
                                   role="tab" aria-controls="tab-{{ admin.uniqid }}-valores"
                                   aria-selected="false" data-toggle="tab">
                                    <i style="color: {{ colores.verde_oscuro }};" class="fas fa-money-bill tab-icon" aria-hidden="true"></i>
                                    <span>{{ 'tab_valores'|trans({},'messages')|capitalize}}</span>
                                </a>
                            </li>
                            <li role="presentation">
                                <a href="#tab-{{ admin.uniqid }}-internoincluye"
                                   role="tab" aria-controls="tab-{{ admin.uniqid }}-internoincluye"
                                   aria-selected="false" data-toggle="tab">
                                    <i style="color: #ff9090" class="fas fa-check-double tab-icon" aria-hidden="true"></i>
                                    <span>{{ 'tab_internoincluye'|trans({},'messages')|capitalize}}</span>
                                </a>
                            </li>
                        {% endif %}

                        {% if action == 'show' or action == 'operaciones' %}
                            <li role="presentation">
                                <a href="#tab-{{ admin.uniqid }}-operativa"
                                   role="tab" aria-controls="tab-{{ admin.uniqid }}-operativa"
                                   aria-selected="false" data-toggle="tab">
                                    <i style="color: {{ colores.lila }}" class="fas fa-map tab-icon" aria-hidden="true"></i>
                                    <span>{{ 'tab_operativa'|trans({},'messages')|capitalize}}</span>
                                </a>
                            </li>
                        {% endif %}

                        {% if action == 'show' %}
                            <li role="presentation">
                                <a href="#tab-{{ admin.uniqid }}-mensajes"
                                   role="tab" aria-controls="tab-{{ admin.uniqid }}-mensajes"
                                   aria-selected="false" data-toggle="tab">
                                    <i class="fas fa-envelope tab-icon" aria-hidden="true"></i>
                                    <span>{{ 'tab_mensajes'|trans({},'messages')|capitalize}}</span>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </div>

                <div class="tab-content tab-content-modern no-padding">
                    <div class="tab-pane fade in active" id="tab-{{ admin.uniqid }}-resumen">
                        {% include 'cotizacion_cotizacion_admin/show__resumen.html.twig' %}
                    </div>

                    <div class="tab-pane fade" id="tab-{{ admin.uniqid }}-itinerario">
                        {% include 'cotizacion_cotizacion_admin/show__itinerario.html.twig' %}
                    </div>

                    {% if action == 'show' or (action == 'resumen' and object.precioocultoresumen == false) %}
                        <div class="tab-pane fade" id="tab-{{ admin.uniqid }}-tarifas">
                            {% include 'cotizacion_cotizacion_admin/show__tarifas.html.twig' %}
                        </div>
                    {% endif %}

                    <div class="tab-pane fade" id="tab-{{ admin.uniqid }}-incluye">
                        {% include 'cotizacion_cotizacion_admin/show__incluye.html.twig' %}
                    </div>

                    {% if action == 'show' or (action == 'resumen' and object.precioocultoresumen == false) %}
                        <div class="tab-pane fade" id="tab-{{ admin.uniqid }}-politica">
                            <div class="no-print box-body container-fluid">
                                <div class="sonata-ba-collapsed-fields">
                                    <div class="box-body table-responsive">
                                        <h3 class="no-padding no-margin visible-print">{{ 'tab_terminos'|trans({}, 'messages')|capitalize}}</h3>
                                        <div class="ck-content">{{ object.cotpolitica.contenido|raw }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    {% if action == 'show' %}
                        <div class="tab-pane fade" id="tab-{{ admin.uniqid }}-valores">
                            {% include 'cotizacion_cotizacion_admin/show__valores.html.twig' %}
                        </div>
                        <div class="tab-pane fade" id="tab-{{ admin.uniqid }}-internoincluye">
                            {% include 'cotizacion_cotizacion_admin/show__internoincluye.html.twig' %}
                        </div>
                        <div class="tab-pane fade" id="tab-{{ admin.uniqid }}-mensajes">
                            {% include 'cotizacion_cotizacion_admin/show__mensajes.html.twig' %}
                        </div>
                    {% endif %}

                    {% if action == 'show' or action == 'operaciones' %}
                        <div class="tab-pane fade" id="tab-{{ admin.uniqid }}-operativa">
                            {% include 'cotizacion_cotizacion_admin/show__operativa.html.twig' %}
                        </div>
                    {% endif %}
                </div>
            </div>

        </div>
    </div>

</div>

    {{ sonata_block_render_event('sonata.admin.show.bottom', { 'admin': admin, 'object': object }) }}
{% endblock %}
