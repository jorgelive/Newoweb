<div class="container-fluid hidden-print">
    <div class="row">
        {# 1) ID de unidad a comparar: sirve si object es unidad o si tiene unit #}
        {% set expectedUnitId =
            attribute(object, 'unit') is defined and object.unit is not null and attribute(object.unit, 'id') is defined
            ? object.unit.id
            : (attribute(object, 'id') is defined ? object.id : null)
        %}

        {% set total = 0 %}

        {% for archivo in caracteristica.unittipocaracteristica.unitmedios %}
            {# 2) Seguridad: validar unit en el archivo #}
            {% set hasUnit = attribute(archivo, 'unit') is defined
                and archivo.unit is not null
                and attribute(archivo.unit, 'id') is defined %}

            {% if expectedUnitId is not null and hasUnit and archivo.unit.id == expectedUnitId %}
                {% set total = total + 1 %}

                {# 3) Orientación segura (portrait/landscape) #}
                {% set orient = (attribute(archivo, 'aspectRatio') is defined and archivo.aspectRatio is not null)
                    ? (archivo.aspectRatio < 1 ? 'portrait' : 'landscape')
                    : '' %}

                <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
                    <figure class="thumbnail thumbnail-fluid">
                        <a
                                href="{% if archivo.tipo == 'local' %}
                      {{ app.request.getSchemeAndHttpHost() ~ archivo.webPath|raw }}
                    {% else %}
                      {{ archivo.webPath|raw }}
                    {% endif %}"
                                {% if attribute(archivo, 'inModal') is defined and archivo.inModal %}
                                    data-toggle="lightbox"
                                    data-gallery="{{ attribute(archivo,'unittipocaracteristica') is defined
                                    and archivo.unittipocaracteristica is not null
                                    and attribute(archivo.unittipocaracteristica,'nombre') is defined
                                    ? archivo.unittipocaracteristica.nombre
                                    : (attribute(caracteristica,'unittipocaracteristica') is defined
                                    and caracteristica.unittipocaracteristica is not null
                                    and attribute(caracteristica.unittipocaracteristica,'nombre') is defined
                                    ? caracteristica.unittipocaracteristica.nombre
                                    : 'galeria') }}"
                                {% else %}
                                    target="_blank" rel="noopener noreferrer"
                                {% endif %}
                                aria-label="{{ attribute(archivo,'titulo') is defined ? archivo.titulo : 'Medio' }}"
                        >
                            <img
                                    src="{% if archivo.tipo == 'local' %}
                        {{ app.request.getSchemeAndHttpHost() ~ archivo.webThumbPath|raw }}
                      {% else %}
                        {{ archivo.webThumbPath|raw }}
                      {% endif %}"
                                    alt="{{ attribute(archivo,'titulo') is defined ? archivo.titulo : 'Medio sin título' }}"
                                    class="img-responsive{% if attribute(archivo,'inModal') is defined and archivo.inModal %} in-modal{% endif %}{{ orient ? ' ' ~ orient : '' }}"
                                    {# si usas BS4/5 agrega también img-fluid: class="img-responsive img-fluid ..." #}
                                    loading="lazy" decoding="async"
                            >
                            <figcaption class="caption">
                                <p class="small text-center" style="word-break: break-word;">
                                    {{ attribute(archivo,'titulo') is defined ? archivo.titulo : '' }}
                                </p>
                            </figcaption>
                        </a>
                    </figure>
                </div>
            {% endif %}
        {% endfor %}

        {#
        {% if total == 0 %}
            <div class="col-xs-12">
                <div class="alert alert-info m-t-10">No hay medios disponibles para esta unidad.</div>
            </div>
        {% endif %}
        #}
    </div>
</div>