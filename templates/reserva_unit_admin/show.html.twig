{% extends 'base_sonata_admin/show.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <style>

        /* Encabezado de alojamiento (BS3) */
        .encabezado .sonata-ba-view-container th { width: 220px; }
        .encabezado .table > tbody > tr > th,
        .encabezado .table > tbody > tr > td { vertical-align: middle; }

        /* =========================================================
   TABS MODERNAS — BS3 / AdminLTE2
   Pill + Multilínea + Tamaños + Sin subrayado
   Y PARCHE para quitar el "subrayado" verde (#58954e) del activo
   en .nav-tabs-custom > .nav-tabs > li.active
   ========================================================= */

        /* --- PARCHE Anti-Subrayado Verde de nav-tabs-custom --- */
        /* AdminLTE pone un borde superior de color (p.ej. #58954e). Lo anulamos. */
        .nav-tabs-custom > .nav-tabs > li.active,
        .nav-tabs-custom > .nav-tabs > li.active > a,
        .nav-tabs-custom > .nav-tabs > li.active > a:hover,
        .nav-tabs-custom > .nav-tabs > li.active > a:focus {
            border: none !important;
            border-top: 0 !important;
            border-bottom: 0 !important;
            border-left: 0 !important;
            border-right: 0 !important;
            box-shadow: none !important;
        }

        /* A veces el skin define border-top-color específicamente. Lo apagamos. */
        .nav-tabs-custom > .nav-tabs > li.active {
            border-top-color: transparent !important;
        }

        /* Y evitamos que :hover vuelva a inyectar borde */
        .nav-tabs-custom > .nav-tabs > li > a:hover,
        .nav-tabs-custom > .nav-tabs > li > a:focus {
            border-color: transparent !important;
        }

        /* Extra: si el tema fuerza #58954e, lo anulamos igualmente */
        .nav-tabs-custom > .nav-tabs > li.active,
        .nav-tabs-custom > .nav-tabs > li.active > a {
            border-color: transparent !important; /* mata cualquier #58954e heredado */
        }

        /* --- Base Tabs Modernas (sin línea contenedora) --- */
        .tabs-modern {
            border-bottom: 0 !important;      /* sin línea inferior del UL */
            margin-bottom: 10px;
        }

        /* Multilínea real (anula floats de BS3) */
        .tabs-modern.tabs-modern--multiline {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;                  /* permite varias filas */
            align-items: stretch;
        }
        .tabs-modern.tabs-modern--multiline > li {
            float: none !important;           /* quita float de BS3 */
            display: block;
            -ms-flex: 0 1 auto;
            flex: 0 1 auto;
            margin: 6px 6px 0 0;             /* separación entre pills y filas */
        }

        /* Link base (cómodo, legible) — SIN subrayado */
        .tabs-modern > li > a,
        .tabs-modern > li > a:hover,
        .tabs-modern > li > a:focus,
        .tabs-modern > li.active > a,
        .tabs-modern > li.active > a:hover,
        .tabs-modern > li.active > a:focus {
            text-decoration: none !important;
        }
        .tabs-modern > li > a {
            position: relative;
            padding: 10px 14px;
            font-weight: 600;
            color: #667085;
            background: transparent;
            letter-spacing: .2px;
            transition: color .2s, background-color .2s, border-color .2s;
            border: none !important;          /* anula borde de BS3 en el <a> */
            white-space: nowrap;              /* el texto no se parte; el item salta de línea */
            line-height: 1.25;
            outline: none;
        }
        /* Por si algún theme usa pseudo-elemento como underline */
        .tabs-modern > li > a::after,
        .tabs-modern > li > a::before {
            display: none !important;
            content: none !important;
        }

        /* Ícono dentro del tab */
        .tabs-modern > li > a .tab-icon {
            margin-right: 6px;
            opacity: .9;
            font-size: 0.95em;                /* escala con el texto */
        }

        /* --- Variante PILL (borde y fondo propios del <a>) --- */
        .tabs-modern.tabs-modern--pill > li > a {
            border-radius: 18px;
            padding: 8px 14px;
            border: 1px solid transparent;    /* contorno del pill */
        }
        .tabs-modern.tabs-modern--pill > li > a:hover,
        .tabs-modern.tabs-modern--pill > li > a:focus {
            background: rgba(60,141,188,.08); /* fallback AdminLTE primary */
            color: var(--accent, #3c8dbc);
            border-color: var(--accent, #3c8dbc);
        }
        .tabs-modern.tabs-modern--pill > li.active > a,
        .tabs-modern.tabs-modern--pill > li.active > a:focus,
        .tabs-modern.tabs-modern--pill > li.active > a:hover {
            background: rgba(60,141,188,.12);
            color: var(--accent, #3c8dbc);
            border-color: var(--accent, #3c8dbc);
        }

        /* --- Tamaños de letra (elige clase en el <ul>) --- */
        .tabs-modern--sm > li > a { font-size: 13px; }
        .tabs-modern--xs > li > a { font-size: 12px; }

        /* Compactar pill cuando reduces fuente */
        .tabs-modern--sm.tabs-modern--pill > li > a { padding: 6px 10px; border-radius: 16px; }
        .tabs-modern--xs.tabs-modern--pill > li > a { padding: 5px 9px;  border-radius: 14px; }

        /* Solo reducir en desktop (mantener normal en móvil) */
        @media (min-width: 768px){
            .tabs-modern--sm-desktop > li > a { font-size: 13px; }
            .tabs-modern--sm-desktop.tabs-modern--pill > li > a { padding: 6px 10px; border-radius: 16px; }
        }

        /* --- Opcionales útiles --- */
        /* Permitir que el texto quiebre dentro del pill en vez de saltar de fila */
        /* .tabs-modern--wraptext > li > a { white-space: normal; word-break: break-word; } */

        /* Límite de dos filas visible (ajusta 84px según tipografía) */
        /* .tabs-modern.tabs-modern--max2rows { max-height: 84px; overflow: hidden; } */




        {% include 'reserva_reserva_admin/show__parte_galeria.css.twig' %}
    </style>
{% endblock %}

{% block show %}

<div class="sonata-ba-view">
    {{ sonata_block_render_event('sonata.admin.show.top', { 'admin': admin, 'object': object }) }}
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            {# show__encabezado_bs3.html.twig #}
            {% macro itemRow(titulo, contenido) %}
                <tr class="sonata-ba-view-container">
                    <th class="text-muted text-uppercase" style="width:220px; letter-spacing:.2px;">{{ titulo }}</th>
                    <td>{{ contenido|raw }}</td>
                </tr>
            {% endmacro %}
            {% from _self import itemRow %}

            <div class="box box-primary encabezado">
                <div class="box-body table-responsive no-padding">
                    <table class="table table-striped table-hover table-condensed">
                        <caption class="sr-only">Encabezado del alojamiento</caption>
                        <tbody>
                        {{ itemRow(
                            ('alojamiento'|trans({}, 'messages')|capitalize),
                        '<strong>' ~ object.establecimiento.nombre ~ '</strong> ' ~ object.nombre
                        ) }}

                        {{ itemRow(
                            ('descripcion'|trans({}, 'messages')|capitalize),
                        object.descripcion is not empty
                        ? object.descripcion
                        : '<span class="text-muted"><em>' ~ ( 'sin_descripcion'|trans({}, 'messages')|default('Sin descripción') ) ~ '</em></span>'
                        ) }}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="nav-tabs-custom">
                {# tabs__caracteristicas_bs3_pill_multiline_nomacro_v2.html.twig #}
                <ul class="nav nav-tabs tabs-modern tabs-modern--pill tabs-modern--multiline tabs-modern--sm hidden-print" role="tablist">
                    {% set inicializado = false %}
                    {% for index, caracteristica in object.unitcaracteristicas %}
                        {% if not (
                            (caracteristica.unittipocaracteristica.id == constant('App\\Entity\\ReservaUnittipocaracteristica::DB_VALOR_BRIEFING') and action == 'resumen')
                            or
                            (caracteristica.unittipocaracteristica.id == constant('App\\Entity\\ReservaUnittipocaracteristica::DB_VALOR_INVENTARIO') and action == 'resumen')
                            ) %}
                            {% set idTab  = 'tab_' ~ admin.uniqid ~ '_' ~ index %}
                            {% set color  = caracteristica.unittipocaracteristica.iconcolor %}
                            <li role="presentation" class="{% if not inicializado %}active{% endif %}">
                                <a
                                        href="#{{ idTab }}"
                                        role="tab"
                                        data-toggle="tab"
                                        aria-controls="{{ idTab }}"
                                        aria-selected="{{ (not inicializado) ? 'true' : 'false' }}"
                                        style="--accent: {{ color }};"
                                >
                                    <i class="fas {{ caracteristica.unittipocaracteristica.iconclase }} tab-icon" aria-hidden="true"></i>
                                    <span class="tab-title">{{ caracteristica.unittipocaracteristica.titulo }}</span>
                                </a>
                            </li>
                            {% set inicializado = true %}
                        {% endif %}
                    {% endfor %}

                    {# Tab Ubicación #}
                    <li role="presentation">
                        {% set idUbic = 'tab_' ~ admin.uniqid ~ '_ubicacion' %}
                        <a
                                href="#{{ idUbic }}"
                                role="tab"
                                data-toggle="tab"
                                aria-controls="{{ idUbic }}"
                                aria-selected="false"
                                style="--accent: {{ colores.lila }};"
                        >
                            <i class="fas fa-map tab-icon" aria-hidden="true"></i>
                            <span class="tab-title">{{ 'tab_ubicacion'|trans({},'messages')|capitalize }}</span>
                        </a>
                    </li>
                </ul>
                <div class="tab-content no-padding">
                    {% set inicializado = false %}
                    {% for index, caracteristica in object.unitcaracteristicas %}
                        {% if not (
                            (
                            caracteristica.unittipocaracteristica.id == constant('App\\Entity\\ReservaUnittipocaracteristica::DB_VALOR_BRIEFING')
                            and action == 'resumen'
                            ) or (
                            caracteristica.unittipocaracteristica.id == constant('App\\Entity\\ReservaUnittipocaracteristica::DB_VALOR_INVENTARIO')
                            and action == 'resumen'
                            )
                            )
                        %}

                            <div class="tab-pane fade {% if not inicializado %}in active{% endif %}" id="tab_{{ admin.uniqid }}_{{ index }}">

                                <div class="box-body container-fluid">
                                    <div class="sonata-ba-collapsed-fields">
                                        <div class="box-body table-responsive">
                                            <h3 class="visible-print">{{ caracteristica.unittipocaracteristica.titulo }}</h3>
                                            <div class="caracteristicacontent ck-content">{{ caracteristica.contenido | raw }}</div>
                                            {% include 'reserva_reserva_admin/show__parte_galeria.html.twig' %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% set inicializado = true %}
                        {% endif %}
                    {% endfor %}
                    <div class="tab-pane fade" id="tab_{{ admin.uniqid }}_ubicacion">
                        <div class="box-body container-fluid">
                            <div class="sonata-ba-collapsed-fields">
                                {# Ubicación (object.establecimiento.* + object.referencia) #}
                                {% set addr    = object.establecimiento.direccion|default('') %}
                                {% set ref_est = object.establecimiento.referencia|default('') %}
                                {% set ref_obj = object.referencia|default('') %}
                                {% set ref     = (ref_est ~ ' ' ~ ref_obj)|trim %}
                                {% set q       = addr is not empty ? addr : (object.establecimiento.nombre|default('')) %}
                                {% set q_url   = q|e('url') %}
                                {% set maps    = 'https://www.google.com/maps/search/?api=1&query=' ~ q_url %}
                                {% set mapsdir = 'https://www.google.com/maps/dir/?api=1&destination=' ~ q_url %}

                                <div class="box-body table-responsive">
                                    <h3 class="visible-print">{{ 'tab_ubicacion'|trans({}, 'messages')|capitalize }}</h3>

                                    <p class="lead" style="margin-bottom:8px;">
                                        <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                                        <strong>{{ 'direccion'|trans({}, 'messages')|capitalize }}:</strong>
                                        <span>{{ addr }}</span>
                                    </p>

                                    <p class="text-muted" style="font-size:1.05em; margin-bottom:12px;">
                                        <i class="fas fa-info-circle" aria-hidden="true"></i>
                                        <strong>{{ 'referencia'|trans({}, 'messages')|capitalize }}:</strong>
                                        <span>{{ ref is not empty ? ref : ('sin_referencia'|trans({}, 'messages')|default('Sin referencia')) }}</span>
                                    </p>

                                    {# Acciones útiles #}
                                    <div class="btn-toolbar hidden-print" role="toolbar" style="margin-bottom:10px;">
                                        <div class="btn-group btn-group-sm">
                                            <a href="{{ maps }}" target="_blank" rel="noopener" class="btn btn-primary">
                                                <i class="fas fa-external-link-alt" aria-hidden="true"></i>
                                                {{ 'abrir_en_google_maps'|trans({}, 'messages')|default('Abrir en Google Maps') }}
                                            </a>
                                            <a href="{{ mapsdir }}" target="_blank" rel="noopener" class="btn btn-default">
                                                <i class="fas fa-location-arrow" aria-hidden="true"></i>
                                                {{ 'como_llegar'|trans({}, 'messages')|default('Cómo llegar') }}
                                            </a>
                                            <a class="btn btn-default clipboard-trigger" data-text="{{ addr }}">
                                                <i class="fas fa-copy" aria-hidden="true"></i>
                                                {{ 'copiar_direccion'|trans({}, 'messages')|default('Copiar dirección') }}
                                            </a>
                                            <a class="btn btn-default clipboard-trigger" data-text="{{ maps }}">
                                                <i class="fas fa-link" aria-hidden="true"></i>
                                                {{ 'copiar_enlace'|trans({}, 'messages')|default('Copiar enlace') }}
                                            </a>
                                        </div>
                                    </div>

                                    {# Mapa responsive (BS3) #}
                                    <div class="embed-responsive embed-responsive-4by3 hidden-print gmap-wrapper" aria-label="Mapa">
                                        <iframe
                                                class="embed-responsive-item"
                                                id="gmap-frame-{{ object.id }}"
                                                title="{{ 'Mapa de' }} {{ q }}"
                                                loading="lazy"
                                                src="https://www.google.com/maps?q={{ q_url }}&t=&z=17&ie=UTF8&iwloc=&output=embed"
                                                referrerpolicy="no-referrer-when-downgrade"
                                                allowfullscreen>
                                        </iframe>
                                    </div>

                                    {# Fallback sin JS o en impresión #}
                                    <noscript>
                                        <p><a href="{{ maps }}" target="_blank" rel="noopener">
                                                {{ 'ver_mapa'|trans({}, 'messages')|default('Ver mapa') }}
                                            </a></p>
                                    </noscript>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>

    {{ sonata_block_render_event('sonata.admin.show.bottom', { 'admin': admin, 'object': object }) }}
{% endblock %}
