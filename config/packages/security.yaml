security:
    role_hierarchy:
        ROLE_USER:                  []  # <-- sin PUBLIC_ACCESS
        ROLE_ADMIN:                 [ROLE_USER]
        ROLE_FIT_EDITOR:            [ROLE_ADMIN]
        ROLE_TRANSPORTES_EDITOR:    [ROLE_ADMIN]
        ROLE_ADMINISTRACION_EDITOR: [ROLE_ADMIN]
        ROLE_RESERVAS_EDITOR:       [ROLE_ADMIN]
        ROLE_COTIZACIONES_EDITOR:   [ROLE_ADMIN]
        ROLE_OPERACIONES_EDITOR:    [ROLE_ADMIN]
        ROLE_SUPER_ADMIN:           [ROLE_ADMIN, ROLE_ALLOWED_TO_SWITCH, ROLE_FIT_EDITOR, ROLE_TRANSPORTES_EDITOR, ROLE_CARGA, ROLE_ADMINISTRACION_EDITOR, ROLE_RESERVAS_EDITOR, ROLE_COTIZACIONES_EDITOR, ROLE_OPERACIONES_EDITOR]

    password_hashers:
        Sonata\UserBundle\Model\UserInterface: auto

    providers:
        users_in_memory: { memory: null }
        sonata_user_bundle:
            id: sonata.user.security.user_provider

    firewalls:
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false

        main:
            lazy: true
            provider: sonata_user_bundle
            context: user
            form_login:
                login_path: sonata_user_admin_security_login
                check_path: sonata_user_admin_security_check
                default_target_path: sonata_admin_dashboard
            logout:
                path: sonata_user_admin_security_logout
                target: sonata_user_admin_security_login
            remember_me:
                secret: '%env(APP_SECRET)%'
                lifetime: 2629746           # ~30 días
                path: /admin                # Si quieres “recordarme” también en /app, cambia a: /

    access_control:
        # --- Públicos específicos (solo GET) ---
        - { path: '^/app/cotizacioncotservicio/ical$',                 roles: PUBLIC_ACCESS, methods: [GET] }

        - { path: '^/app/reservareserva/ical$',                        roles: PUBLIC_ACCESS, methods: [GET] }
        - { path: '^/app/reservareserva/\d+/resumen/[A-Za-z0-9]+$',    roles: PUBLIC_ACCESS, methods: [GET] }

        - { path: '^/app/reservaunit/\d+/ical$',                       roles: PUBLIC_ACCESS, methods: [GET] }
        - { path: '^/app/reservaunit/\d+/ical\.ics$',                  roles: PUBLIC_ACCESS, methods: [GET] }
        - { path: '^/app/reservaunitnexo/\d+/ical$',                   roles: PUBLIC_ACCESS, methods: [GET] }
        - { path: '^/app/reservaunitnexo/\d+/ical\.ics$',              roles: PUBLIC_ACCESS, methods: [GET] }

        - { path: '^/app/reservaunit/\d+/inventario$',                 roles: PUBLIC_ACCESS, methods: [GET] }
        - { path: '^/app/reservaunit/\d+/resumen$',                    roles: PUBLIC_ACCESS, methods: [GET] }

        - { path: '^/app/cotizacioncotizacion/\d+/resumen/[A-Za-z0-9]+$',  roles: PUBLIC_ACCESS, methods: [GET] }
        - { path: '^/app/cotizacioncotizacion/\d+/operaciones/[A-Za-z0-9]+$', roles: PUBLIC_ACCESS, methods: [GET] }

        - { path: '^/app/cotizacionfile/\d+/resumen/[A-Za-z0-9]+$',    roles: PUBLIC_ACCESS, methods: [GET] }

        - { path: '^/app/fitdieta/\d+/resumen/[A-Za-z0-9]+$',          roles: PUBLIC_ACCESS, methods: [GET] }

        # --- Admin: páginas de login/reset públicas ---
        - { path: '^/admin/login$',        roles: PUBLIC_ACCESS }
        - { path: '^/admin/logout$',       roles: PUBLIC_ACCESS }
        - { path: '^/admin/login_check$',  roles: PUBLIC_ACCESS }
        - { path: '^/admin/request$',      roles: PUBLIC_ACCESS }
        - { path: '^/admin/check-email$',  roles: PUBLIC_ACCESS }
        - { path: '^/admin/reset/.*$',     roles: PUBLIC_ACCESS }

        # --- Admin protegido ---
        - { path: '^/admin',               roles: ROLE_USER }

        # --- App autenticada ---
        - { path: '^/dashboard$',          roles: ROLE_USER }
        - { path: '^/app/',                roles: ROLE_USER }

        # --- Resto del sitio: público (si lo deseas así) ---
        - { path: '^/.*',                  roles: PUBLIC_ACCESS }

when@test:
    security:
        password_hashers:
            Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface:
                algorithm: auto
                cost: 4
                time_cost: 3
                memory_cost: 10
