# config/services/services_pms.yaml
parameters:
    # Las claves de calendatio deben empezar por calendar
    # y ser distintas para que no se sobrescribab
    calendars_pms:
        pms_eventos_no_cancelados:
            provider: pms_eventos_raw
            filters:
                establecimientoId: null
                unidadIds: [ ]
                estado:
                    in: [ ]        # ej: [confirmada, bloqueo]
                    not_in: [cancelada]    # ej: [cancelada]
                estadoPago:
                    in: [ ]        # ej: [no-pagado, pago-parcial]
                    not_in: [ ]    # ej: [pago-total]
            event:
                url:
                    # Si hay reserva -> usa ReservaAdmin
                    reservaEdit:
                        role: ROLE_RESERVAS_WRITE
                        route: panel_dashboard_pms_reserva_edit
                        params:
                            tl: es

                    reservaShow:
                        role: ROLE_RESERVAS_SHOW
                        route: panel_dashboard_pms_reserva_detail
                        params:
                            tl: es

                    # Si NO hay reserva -> usa EventoCalendarioAdmin
                    eventoCalendarioEdit:
                        role: ROLE_RESERVAS_WRITE
                        route: panel_dashboard_pms_evento_calendario_edit
                        params:
                            tl: es

                    eventoCalendarioShow:
                        role: ROLE_RESERVAS_SHOW
                        route: panel_dashboard_pms_evento_calendario_detail
                        params:
                            tl: es
        pms_eventos_todos:
            provider: pms_eventos_raw
            filters:
                establecimientoId: null
                unidadIds: [ ]
                estado:
                    in: [ ]        # ej: [confirmada, bloqueado]
                    not_in: [ ]    # ej: [cancelada]
                estadoPago:
                    in: [ ]        # ej: [no-pagado, pago-parcial]
                    not_in: [ ]    # ej: [pago-total]
            event:
                url:
                    # Si hay reserva -> usa ReservaAdmin
                    reservaEdit:
                        role: ROLE_RESERVAS_WRITE
                        route: panel_dashboard_pms_reserva_edit
                        params:
                            tl: es

                    reservaShow:
                        role: ROLE_RESERVAS_SHOW
                        route: panel_dashboard_pms_reserva_detail
                        params:
                            tl: es

                    # Si NO hay reserva -> usa EventoCalendarioAdmin
                    eventoCalendarioEdit:
                        role: ROLE_RESERVAS_WRITE
                        route: panel_dashboard_pms_evento_calendario_edit
                        params:
                            tl: es

                    eventoCalendarioShow:
                        role: ROLE_RESERVAS_SHOW
                        route: panel_dashboard_pms_evento_calendario_detail
                        params:
                            tl: es

        tarifa_rangos_raw:
            provider: tarifa_ranges_raw
            entity: App\Pms\Entity\PmsTarifaRango
            fields:
                id: id
                resourceRoot: unidad
                resourceId: unidad.id
                resourceTitle: unidad.nombre

                start: fechaInicio
                end: fechaFin
                price: precio
                minStay: minStay
                currency: moneda.codigo

                active: activo

                weight: prioridad          # Mapea a getPeso()
                important: importante # Mapea a isImportante()
            filters:
                activeOnly: false
            event:
                includeCurrency: false
                titleFormat: '{price} | {minStay}'
                url:
                    id: id
                    show:
                        route: panel_dashboard_pms_tarifa_rango_detail
                        role: ROLE_RESERVAS_SHOW
                        params: { tl: 'es' }
                    edit:
                        route: panel_dashboard_pms_tarifa_rango_edit
                        role: ROLE_RESERVAS_WRITE
                        params: { tl: 'es' }
            eventTime:
                start: '12:00:00'
                end: '11:59:59'
        tarifa_rangos_compactados:
            provider: tarifa_compressed_ranges
            entity: App\Pms\Entity\PmsTarifaRango
            fields:
                unit: unidad
                unitId: unidad.id
                unitTitle: unidad.nombre

                start: fechaInicio
                end: fechaFin

                price: precio
                minStay: minStay
                currency: moneda.codigo

                important: importante
                weight: prioridad
                id: id

                active: activo
            filters:
                activeOnly: true
            event:
                url:
                    show:
                        route: panel_dashboard_pms_tarifa_rango_detail
                        role: ROLE_RESERVAS_SHOW
                        params: { tl: 'es' }
                    edit:
                        route: panel_dashboard_pms_tarifa_rango_edit
                        role: ROLE_RESERVAS_WRITE
                        params: { tl: 'es' }
            eventTime:
                start: '12:00:00'
                end: '11:59:59'

services:

    _defaults:
        autowire: true
        autoconfigure: true

    App\Pms\:
        resource: '../../src/Pms/'
        exclude:
            - '../../src/Pms/Dto/'
            - '../../src/Pms/Entity/'
            - '../../src/Pms/Tarifa/Dto/'

    # =========================
    # controllers del m√≥dulo Pms
    # (fuera de src/Controller/)
    # =========================
    App\Pms\Controller\:
        resource: '../../src/Pms/Controller/'
        autowire: true
        autoconfigure: true
        tags:
          - 'controller.service_arguments'

    # =========================
    # Reglas por instanceof lo estouy poniendo como tag directo al archivo
    # =========================
    #_instanceof:
    #    App\Pms\Service\Cron\CronJobInterface:
    #        tags:
    #          - 'app.cron_job'



